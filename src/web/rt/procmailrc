# -*- mode: conf -*-

SHELL=/bin/sh
PATH="/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:{{shconfig_os_base}}/sbin:{{shconfig_os_base}}/bin:{{shconfig_os_base}}/usr/sbin:{{shconfig_os_base}}/usr/bin"
LOGFILE="{{rt_procmail_log}}"
DEFAULT=/dev/null


# FYI all these braces basically say "set the EXITCODE variable and
# then quit." Why does `HOST=` make procmail quit? per
# https://serverfault.com/a/775166 "reassigning HOST has the obscure
# but well-documented side effect of aborting Procmail immediately."
#
# This all works because rt-mailgate returns the errorcode that we
# want to use.

# From address has example.edu in it? accept
:0w
* ^From.*(example)\.edu
{
  :0wc
    | {{rt_dir}}/bin/rt-mailgate --queue $QUEUE --action $ACTION --url "https://{{rt_webdomain}}/"
  :0
    {
      EXITCODE=$? HOST=
    }
}

# FIXME add rules here

# Default: Accept
:0w
{
  :0wc
    | {{rt_dir}}/bin/rt-mailgate --queue $QUEUE --action $ACTION --url "https://{{rt_webdomain}}/"
  :0
    {
      EXITCODE=$? HOST=
    }
}
